<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <title>‡§Ö‡§Ç‡§ï ‡§ú‡•ç‡§Ø‡•ã‡§§‡§ø‡§∑ ‡§ï‡•à‡§≤‡§ï‡•Å‡§≤‡•á‡§ü‡§∞</title>
  <style>
    body {
      font-family: Arial;
      text-align: center;
      background: #f4f4f4;
      padding: 20px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      width: 300px;
      margin: 20px auto;
      gap: 5px;
    }
    .cell {
      border: 1px solid #000;
      padding: 10px;
      background: #fff;
      font-size: 14px;
      min-height: 70px;
    }
    input, select, button {
      padding: 8px;
      margin: 5px;
    }
    .results {
      margin-top: 20px;
      font-size: 18px;
    }
  </style>
</head>
<body>

  <h2>üî¢ ‡§Ö‡§Ç‡§ï ‡§ú‡•ç‡§Ø‡•ã‡§§‡§ø‡§∑ ‡§ï‡•à‡§≤‡§ï‡•Å‡§≤‡•á‡§ü‡§∞</h2>

  <input type="date" id="dobInput">
  <select id="genderSelect">
    <option value="male">‡§™‡•Å‡§∞‡•Å‡§∑</option>
    <option value="female">‡§Æ‡§π‡§ø‡§≤‡§æ</option>
  </select>
  <button onclick="generateGridFromDOB()">‡§ó‡•ç‡§∞‡§ø‡§° ‡§¨‡§®‡§æ‡§è‡§Ç</button>

  <div class="results">
    <div id="driverNumber"></div>
    <div id="conductorNumber"></div>
    <div id="kuaNumber"></div>
  </div>

  <div class="grid" id="loshuGrid">
    <div class="cell" id="cell-4"></div>
    <div class="cell" id="cell-9"></div>
    <div class="cell" id="cell-2"></div>
    <div class="cell" id="cell-3"></div>
    <div class="cell" id="cell-5"></div>
    <div class="cell" id="cell-7"></div>
    <div class="cell" id="cell-8"></div>
    <div class="cell" id="cell-1"></div>
    <div class="cell" id="cell-6"></div>
  </div>

  <script>
    const descriptions = {
      1: "‡§®‡•á‡§§‡§æ, ‡§Æ‡§π‡§§‡•ç‡§µ‡§æ‡§ï‡§æ‡§Ç‡§ï‡•ç‡§∑‡•Ä",
      2: "‡§Æ‡§ß‡•Å‡§∞, ‡§∏‡§π‡§®‡§∂‡•Ä‡§≤",
      3: "‡§∞‡§ö‡§®‡§æ‡§§‡•ç‡§Æ‡§ï, ‡§Ü‡§®‡§Ç‡§¶‡§™‡•ç‡§∞‡§ø‡§Ø",
      4: "‡§∏‡•ç‡§•‡§ø‡§∞, ‡§µ‡•ç‡§Ø‡§æ‡§µ‡§π‡§æ‡§∞‡§ø‡§ï",
      5: "‡§∏‡§æ‡§π‡§∏‡•Ä, ‡§≤‡§ö‡•Ä‡§≤‡§æ",
      6: "‡§¶‡•á‡§ñ‡§≠‡§æ‡§≤ ‡§ï‡§∞‡§®‡•á ‡§µ‡§æ‡§≤‡§æ, ‡§ú‡§ø‡§Æ‡•ç‡§Æ‡•á‡§¶‡§æ‡§∞",
      7: "‡§µ‡§ø‡§ö‡§æ‡§∞‡§ï, ‡§Ü‡§ß‡•ç‡§Ø‡§æ‡§§‡•ç‡§Æ‡§ø‡§ï",
      8: "‡§∂‡§ï‡•ç‡§§‡§ø‡§∂‡§æ‡§≤‡•Ä, ‡§Ö‡§®‡•Å‡§∂‡§æ‡§∏‡§ø‡§§",
      9: "‡§¶‡§Ø‡§æ‡§≤‡•Å, ‡§≠‡§æ‡§µ‡•Å‡§ï"
    };

    function fillGrid(repeats) {
      for (let i = 1; i <= 9; i++) {
        const cell = document.getElementById("cell-" + i);
        const value = repeats[i] || "";
        cell.innerHTML = `<div style="font-weight:bold;">${value}</div>
                          <div style="font-size:12px; color: #666;">${descriptions[i]}</div>`;
      }
    }

    function getDriverNumber(dob) {
      const day = parseInt(dob.split('-')[2]);
      let sum = day;
      while (sum >= 10) {
        sum = sum.toString().split('').reduce((a, b) => a + parseInt(b), 0);
      }
      return sum;
    }

    function getConductorNumber(dob) {
      const numbers = dob.replace(/\D/g, '').split('').map(Number);
      let sum = numbers.reduce((acc, val) => acc + val, 0);
      while (sum >= 10) {
        sum = sum.toString().split('').reduce((a, b) => a + parseInt(b), 0);
      }
      return sum;
    }

    function getKuaNumber(dob, gender) {
      const year = parseInt(dob.split('-')[0]);
      const lastTwo = year % 100;
      let sum = lastTwo.toString().split('').reduce((a, b) => a + parseInt(b), 0);
      while (sum >= 10) {
        sum = sum.toString().split('').reduce((a, b) => a + parseInt(b), 0);
      }

      let kua;
      if (gender.toLowerCase() === 'male') {
        kua = (year >= 2000) ? 9 - sum : 10 - sum;
      } else {
        kua = (year >= 2000) ? 6 + sum : 5 + sum;
      }

      while (kua >= 10) {
        kua = kua.toString().split('').reduce((a, b) => a + parseInt(b), 0);
      }

      return kua;
    }

    function generateGridFromDOB() {
      const dob = document.getElementById("dobInput").value;
      const gender = document.getElementById("genderSelect").value;
      if (!dob) {
        alert("‡§ï‡•É‡§™‡§Ø‡§æ ‡§ú‡§®‡•ç‡§Æ ‡§§‡§ø‡§•‡§ø ‡§ö‡•Å‡§®‡•á‡§Ç‡•§");
        return;
      }

      const digits = dob.replace(/\D/g, '').split('').filter(d => d !== "0");
      const repeats = {};
      for (let i = 1; i <= 9; i++) repeats[i] = "";

      digits.forEach(d => {
        repeats[d] += d;
      });

      fillGrid(repeats);

      const driver = getDriverNumber(dob);
      const conductor = getConductorNumber(dob);
      const kua = getKuaNumber(dob, gender);

      document.getElementById("driverNumber").textContent = `üß≠ ‡§°‡•ç‡§∞‡§æ‡§á‡§µ‡§∞ ‡§®‡§Ç‡§¨‡§∞: ${driver}`;
      document.getElementById("conductorNumber").textContent = `üîå ‡§ï‡§Ç‡§°‡§ï‡•ç‡§ü‡§∞ ‡§®‡§Ç‡§¨‡§∞: ${conductor}`;
      document.getElementById("kuaNumber").textContent = `üåê ‡§ï‡•Å‡§Ü ‡§®‡§Ç‡§¨‡§∞ (${gender === 'male' ? '‡§™‡•Å‡§∞‡•Å‡§∑' : '‡§Æ‡§π‡§ø‡§≤‡§æ'}): ${kua}`;
    }
  </script>

</body>
</html>
